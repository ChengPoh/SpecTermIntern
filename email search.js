javascript:(function() {    function manageProcess() {        console.log("Starting or continuing process...");        var state = sessionStorage.getItem("processState");        if (!state) {            initializeProcess();        } else {            continueProcess();        }    }    function initializeProcess() {        console.log("No ongoing process found, initializing...");        var employeeIDs = prompt("Please paste the Employee IDs").split("\r\n").filter(function(e) {            return e.trim() !== "";        });        sessionStorage.setItem("employeeIDs", JSON.stringify(employeeIDs));        sessionStorage.setItem("currentIndex", "0");        sessionStorage.setItem("processState", "searching");        sessionStorage.setItem("emails", JSON.stringify([]));        continueProcess();    }    function continueProcess() {        var employeeIDs = JSON.parse(sessionStorage.getItem("employeeIDs"));        var currentIndex = parseInt(sessionStorage.getItem("currentIndex"), 10);        var processState = sessionStorage.getItem("processState");        if (currentIndex < employeeIDs.length) {            if (processState === "searching") {                navigateToSearch(employeeIDs[currentIndex]);            } else if (processState === "loadingProfile") {                navigateToProfile();            } else if (processState === "extractingEmail") {                extractEmailAndProceed();            } else if (processState === "waitingForProfileSelection") {                checkForEmailOrPromptUser();            }        } else {            console.log("Processing completed.");            downloadCSV();            clearSession();        }    }    function navigateToSearch(employeeID) {        console.log(`Navigating to search URL for Employee ID: ${employeeID}`);        console.log("Please click the bookmarklet again after the search page loads.");        var searchURL = `https://nam.delve.office.com/?q=${employeeID}&searchview=all&v=search`;        sessionStorage.setItem("processState", "loadingProfile");        window.location.href = searchURL;    }    function navigateToProfile() {        var emailElement = document.getElementsByClassName("ExpandedProfileProperty-module__dataWithIcon__QbmpG fabric-module__ms-font-m__pzTW9")[0];        if (emailElement && emailElement.innerText.includes("@globalfoundries.com")) {            console.log(`Extracted Email: ${emailElement.innerText.trim()}`);            var employeeIDs = JSON.parse(sessionStorage.getItem("employeeIDs"));            var currentIndex = parseInt(sessionStorage.getItem("currentIndex"), 10);            var employeeID = employeeIDs[currentIndex];            var emails = JSON.parse(sessionStorage.getItem("emails") || "[]");            emails.push({ employeeID: employeeID, email: emailElement.innerText.trim() });            sessionStorage.setItem("emails", JSON.stringify(emails));            incrementIndexAndContinue();        } else {            var profileLinkElements = document.getElementsByClassName("ProfileSearchResult-module__name___38Hkb");            if (profileLinkElements.length > 1) {                console.log("Multiple profiles found. Attempting to extract email.");                sessionStorage.setItem("processState", "waitingForProfileSelection");                alert("Multiple profiles found. Please manually select the correct profile, then click the bookmarklet again.");            } else if (profileLinkElements.length === 1) {                var profileLinkElement = profileLinkElements[0];                console.log(`Navigating to profile URL: ${profileLinkElement.href}`);                console.log("Please click the bookmarklet again after the profile page loads.");                sessionStorage.setItem("processState", "extractingEmail");                window.location.href = profileLinkElement.href;            } else {                console.log("Profile link not found. No email found.");                recordNoEmailFound();                incrementIndexAndContinue();            }        }    }    function extractEmailAndProceed() {        var emailElement = document.getElementsByClassName("ExpandedProfileProperty-module__dataWithIcon__QbmpG fabric-module__ms-font-m__pzTW9")[0];        var employeeIDs = JSON.parse(sessionStorage.getItem("employeeIDs"));        var currentIndex = parseInt(sessionStorage.getItem("currentIndex"), 10);        var employeeID = employeeIDs[currentIndex];        if (emailElement && emailElement.innerText.includes("@globalfoundries.com")) {            console.log(`Extracted Email: ${emailElement.innerText.trim()}`);            var emails = JSON.parse(sessionStorage.getItem("emails") || "[]");            emails.push({ employeeID: employeeID, email: emailElement.innerText.trim() });            sessionStorage.setItem("emails", JSON.stringify(emails));            incrementIndexAndContinue();        } else {            console.log("Email element not found. No email found.");            sessionStorage.setItem("processState", "waitingForProfileSelection");            alert("Please manually select the correct profile, then click the bookmarklet again.");        }    }    function checkForEmailOrPromptUser() {        var emailElement = document.getElementsByClassName("ExpandedProfileProperty-module__dataWithIcon__QbmpG fabric-module__ms-font-m__pzTW9")[0];        var employeeIDs = JSON.parse(sessionStorage.getItem("employeeIDs"));        var currentIndex = parseInt(sessionStorage.getItem("currentIndex"), 10);        var employeeID = employeeIDs[currentIndex];        if (emailElement && emailElement.innerText.includes("@globalfoundries.com")) {            console.log(`Extracted Email from multiple profiles: ${emailElement.innerText.trim()}`);            var emails = JSON.parse(sessionStorage.getItem("emails") || "[]");            emails.push({ employeeID: employeeID, email: emailElement.innerText.trim() });            sessionStorage.setItem("emails", JSON.stringify(emails));            incrementIndexAndContinue();        } else {            alert("Multiple profiles found. Please manually select the correct profile, then click the bookmarklet again.");        }    }    function recordNoEmailFound() {        var employeeIDs = JSON.parse(sessionStorage.getItem("employeeIDs"));        var currentIndex = parseInt(sessionStorage.getItem("currentIndex"), 10);        var employeeID = employeeIDs[currentIndex];        var emails = JSON.parse(sessionStorage.getItem("emails") || "[]");        emails.push({ employeeID: employeeID, email: "no email found" });        sessionStorage.setItem("emails", JSON.stringify(emails));    }    function incrementIndexAndContinue() {        var currentIndex = parseInt(sessionStorage.getItem("currentIndex"), 10);        sessionStorage.setItem("currentIndex", currentIndex + 1);        sessionStorage.setItem("processState", "searching");        continueProcess();    }    function downloadCSV() {        var emails = JSON.parse(sessionStorage.getItem("emails") || "[]");        var csvContent = "data:text/csv;charset=utf-8,Employee ID,Email\n";        emails.forEach(function(entry) {            csvContent += `${entry.employeeID},${entry.email}\n`;        });        var encodedUri = encodeURI(csvContent);        var link = document.createElement("a");        link.setAttribute("href", encodedUri);        link.setAttribute("download", "emails.csv");        document.body.appendChild(link);        link.click();        document.body.removeChild(link);    }    function clearSession() {        sessionStorage.removeItem("employeeIDs");        sessionStorage.removeItem("emails");        sessionStorage.removeItem("currentIndex");        sessionStorage.removeItem("processState");    }    manageProcess();})();
